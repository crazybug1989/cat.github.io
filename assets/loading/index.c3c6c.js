window.__require=function e(t,o,n){function r(i,s){if(!o[i]){if(!t[i]){var l=i.split("/");if(l=l[l.length-1],!t[l]){var c="function"==typeof __require&&__require;if(!s&&c)return c(l,!0);if(a)return a(l,!0);throw new Error("Cannot find module '"+i+"'")}i=l}var u=o[i]={exports:{}};t[i][0].call(u.exports,function(e){return r(t[i][1][e]||e)},u,u.exports,e,t,o,n)}return o[i].exports}for(var a="function"==typeof __require&&__require,i=0;i<n.length;i++)r(n[i]);return r}({loadingBase:[function(e,t,o){"use strict";cc._RF.push(t,"851a7UnrS5O66TtXaDaDGVC","loadingBase");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var r,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(i=(a<3?r(i):a>3?r(t,o,i):r(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i},i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,a){function i(e){try{l(n.next(e))}catch(t){a(t)}}function s(e){try{l(n.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,s)}l((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var o,n,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return l([e,t])}}function l(a){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(s){a=[6,s],n=0}finally{o=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var l=e("../../../const/consts"),c=e("../../framework/plugin/net/http/netHttp"),u=e("../../framework/plugin/platform/platform"),d=cc._decorator,p=d.ccclass,f=(d.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loadings=[],t.loadingProgress=0,t.bundleLoadingCount=0,t.bundleResLoadingCount=0,t.resLoadingWeight=70,t.bundleLoadingWeight=50,t.bundleResLoadingWeight=50,t}return r(t,e),t.prototype.init=function(){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return u.platform.instance.init(),l.consts.USING_UPDATE?[4,u.platform.instance.checkUpdateSync()]:[3,2];case 1:if(e.sent())return[2];e.label=2;case 2:return l.consts.USING_LOGIN?[4,u.platform.instance.asyncLogin()]:[3,4];case 3:e.sent(),e.label=4;case 4:return this.loadBundleArray(),[2]}})})},t.prototype.loadBundleArray=function(){0===this.loadings.length&&this.loadBundleResArray()},t.prototype.loadBundle=function(e){console.log("\u5f00\u59cb\u8f7d\u5165\u5305",e),this.loadings.push(e),cc.assetManager.loadBundle(e,this.loadBundleComplete.bind(this))},t.prototype.loadBundleComplete=function(e,t){if(e)console.error("\u8d44\u6e90\u5305\u52a0\u8f7d\u5931\u8d25",e.message);else{this.loadingProgress+=this.bundleLoadingWeight/(100*this.bundleLoadingCount)*this.resLoadingWeight,console.log("\u8f7d\u5165Bundle\u6210\u529f",t.name);var o=t.name,n=this.loadings.indexOf(o);-1!==n&&this.loadings.splice(n,1),this.loadings.length>0||this.loadBundleResArray()}},t.prototype.loadBundleResArray=function(){0===this.loadings.length&&this.loadRemoteArray()},t.prototype.loadBundleRes=function(e,t,o,n){var r=this;this.loadings.push(t),cc.assetManager.getBundle(e).load(t,o,function(e,o){if(e)console.error("\u5305\u5185\u8d44\u6e90\u52a0\u8f7d\u5931\u8d25",e.message);else{r.loadingProgress+=r.bundleResLoadingWeight/(100*r.bundleResLoadingCount)*r.resLoadingWeight,console.log("\u8f7d\u5165\u5305\u5185\u8d44\u6e90\u6210\u529f",t),n&&n(o);var a=r.loadings.indexOf(t);-1!==a&&r.loadings.splice(a,1),r.loadings.length>0||r.loadRemoteArray()}})},t.prototype.loadRemoteArray=function(){0===this.loadings.length&&this.enterGame()},t.prototype.loadRemoteRes=function(e,t){var o=this;this.loadings.push(e),c.netHttp.get(e,function(n){var r=o.loadings.indexOf(e);t&&t(n),-1!==r&&o.loadings.splice(r,1),o.loadings.length>0||o.enterGame()})},t.prototype.enterGame=function(){},t.prototype.showUpgradeTips=function(){},a([p],t)}(cc.Component));o.default=f,cc._RF.pop()},{"../../../const/consts":void 0,"../../framework/plugin/net/http/netHttp":void 0,"../../framework/plugin/platform/platform":void 0}],loading:[function(e,t,o){"use strict";cc._RF.push(t,"90c24SWU3pNdL/CapKFC19Y","loading");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=this&&this.__decorate||function(e,t,o,n){var r,a=arguments.length,i=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(i=(a<3?r(i):a>3?r(t,o,i):r(t,o))||i);return a>3&&i&&Object.defineProperty(t,o,i),i},i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,a){function i(e){try{l(n.next(e))}catch(t){a(t)}}function s(e){try{l(n.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,s)}l((n=n.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var o,n,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return l([e,t])}}function l(a){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,n&&(r=2&a[0]?n.return:a[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,a[1])).done)return r;switch(n=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(s){a=[6,s],n=0}finally{o=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var l=e("../../../const/consts"),c=e("../../framework/data/data"),u=e("../../framework/db/db"),d=e("../../framework/plugin/dialog/dialogDB"),p=e("../../framework/plugin/dialog/dialogMgr"),f=e("../../framework/plugin/platform/platform"),g=e("../../framework/plugin/sound/soundMgr"),h=e("../../framework/prefab/toast/xToast"),y=e("./loadingBase"),b=cc._decorator,m=b.ccclass,v=b.property,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.progressLabel=null,t.loadingBar=null,t}return r(t,e),t.prototype.onLoad=function(){return i(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return cc.game.setFrameRate(f.platform.instance.getFrameRate()),this.progressLabel.string="\u52a0\u8f7d\u4e2d...0%",this.loadingBar.progress=0,this.loadingProgress=0,[4,this.init()];case 1:return e.sent(),[2]}})})},t.prototype.update=function(e){this.loadingBar.progress<this.loadingProgress/100&&(this.loadingBar.progress+=.3*e,this.progressLabel.string="\u52a0\u8f7d\u4e2d..."+Math.floor(100*this.loadingBar.progress)+"%")},t.prototype.loadBundleArray=function(){this.loadBundle("audio"),this.loadBundle("common"),this.loadBundle("dialog"),this.loadBundle("catRes01"),this.loadBundle("catRes02"),this.loadBundle("catRes03"),this.loadBundle("cat"),this.loadBundle("game"),this.bundleLoadingCount=this.loadings.length},t.prototype.loadBundleResArray=function(){g.soundMgr.instance.init(cc.assetManager.getBundle("audio")),l.consts.USING_TOAST&&h.xToast.instance.asyncLoad(),l.consts.DB_TYPE===l.DBType.LOCAL&&this.loadBundleRes("framework","db/json/game",cc.JsonAsset,function(e){u.db.game.load(e.json),console.log("\u9759\u6001\u672c\u5730\u6570\u636e\u8bfb\u53d6\u5b8c\u6210")}),this.loadBundleRes("framework","db/json/dialog",cc.JsonAsset,function(e){d.dialogDB.instance.load(e.json),console.log("\u754c\u9762\u6570\u636e\u8bfb\u53d6\u5b8c\u6210"),p.dialogMgr.instance.init(cc.assetManager.getBundle("dialog"),!0),console.log("\u754c\u9762\u521d\u59cb\u5316\u5b8c\u6210")}),this.bundleResLoadingCount=this.loadings.length},t.prototype.loadRemoteArray=function(){if(l.consts.DB_TYPE===l.DBType.REMOTE){var t="https://enjoygaga.com/gnmx/game-"+f.platform.instance.getDBVersion()+".json";this.loadRemoteRes(t,function(e){var t=JSON.parse(e);console.log("\u8bfb\u53d6\u8fdc\u7a0b\u9759\u6001\u6570\u636e\u5b8c\u6210"),u.db.game.load(t)})}e.prototype.loadRemoteArray.call(this)},t.prototype.enterGame=function(){var e=this;c.data.instance.read(l.consts.USING_REMOTE_STORAGE,function(){e.loadScene()})},t.prototype.loadScene=function(){var e=this,t=this.loadingProgress;cc.director.preloadScene("game",function(o,n){console.log("\u52a0\u8f7d\u521d\u59cb\u573a\u666f",o,n);var r=Math.floor(o/n*(100-t));e.progressLabel.string="\u52a0\u8f7d\u4e2d..."+(r+t)+"%",(r+t)/100>e.loadingBar.progress&&(e.loadingBar.progress=(r+t)/100)},function(e){e?console.error("\u52a0\u8f7d\u521d\u59cb\u573a\u666f\u5931\u8d25",e.message):cc.director.loadScene("game")})},t.prototype.showUpgradeTips=function(){console.log("\u6709\u65b0\u7248\u672c\u6b63\u5728\u4e0b\u8f7d\u4e2d...")},a([v(cc.Label)],t.prototype,"progressLabel",void 0),a([v(cc.ProgressBar)],t.prototype,"loadingBar",void 0),a([m],t)}(y.default);o.default=_,cc._RF.pop()},{"../../../const/consts":void 0,"../../framework/data/data":void 0,"../../framework/db/db":void 0,"../../framework/plugin/dialog/dialogDB":void 0,"../../framework/plugin/dialog/dialogMgr":void 0,"../../framework/plugin/platform/platform":void 0,"../../framework/plugin/sound/soundMgr":void 0,"../../framework/prefab/toast/xToast":void 0,"./loadingBase":"loadingBase"}]},{},["loading","loadingBase"]);